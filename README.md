# simple-cdn



## !!! при локальном тесте нет возможности получить IP клиента (не передается __X-Forwarded-For__)

## Изменить стандартный dns на mac: системные настройки -> сеть -> дополнительно -> DNS -> + -> 127.0.0.1

# Пример сети
Сеть состоит из 4 сервисов: __gate__, __center__, __node1__, __node2__

[сайт](https://cdn.site.com/)

### gate - принимает запросы
После получения запроса, по заголовку __X-Forwarded-For__ определяет ближайший сервер из __node__. Перенаправляет на IP этого сервера

### center - хранит файлы
Отдает файлы кэширующим серверам. Принимает файлы по _/upload POST_

### node - отдает файлы
кэширующий сервер на nginx, получает файлы с сервиса __center__

### сервис dns - для теста
Работает в локальной сети. Для сайта cdn.site.com возвращает 127.0.0.1


## Что редактировать
Сервысы доджны быть размещены на отдельных серверах с своими IP адресами. 
В настройках DNS сервера за адресом сайта должны быть закреплены все эти IP адреса.

В nginx конфиге сервиса gate нужно по примеру перечислить коды стран и закрепить за ними IP 

